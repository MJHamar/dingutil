#!/bin/bash
case "$1" in
    --yeah)
        exit_code=0
        ;;
    --nope)
        exit_code=1
        ;;
    --code=* )
        # support --code=NUMBER
        code_val="${1#--code=}"
        if [[ "$code_val" =~ ^[0-9]+$ ]]; then
            exit_code=$code_val
        else
            echo "Invalid numeric code: $code_val" >&2
            exit 2
        fi
        ;;
    --code)
        # support --code NUMBER
        shift
        code_val="$1"
        if [[ -z "$code_val" ]]; then
            echo "Missing numeric code after --code" >&2
            exit 2
        fi
        if [[ "$code_val" =~ ^[0-9]+$ ]]; then
            exit_code=$code_val
        else
            echo "Invalid numeric code: $code_val" >&2
            exit 2
        fi
        ;;
    *)
        # Run the command and capture its exit code
        "$@"
        exit_code=$?
        ;;
esac

# depending on the platform, choose the right sound command
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    player=afplay
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    # Linux
    player='aplay -q'
else
# no windows for now.
    player=echo # placeholder
fi

SUCCESS_SOUND=sounds/classic-bike-bell-distorted-double-1.wav
ERROR_SOUND=sounds/bottlefullmute-1.wav

if [ $exit_code -eq 0 ]; then
    $player $SUCCESS_SOUND &
else
    $player $ERROR_SOUND &
fi

# Exit with the same code as the original command
exit $exit_code
